<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - Emil Fashion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen p-4">

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">ðŸ“Š Emil Fashion Admin Dashboard</h1>
    <div>
      <button onclick="toggleDarkMode()" class="px-3 py-1 rounded bg-gray-800 text-white dark:bg-white dark:text-black">Toggle Dark Mode</button>
      <button onclick="logout()" class="ml-2 px-3 py-1 rounded bg-red-600 text-white">Logout</button>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="p-4 bg-gray-100 dark:bg-gray-800 rounded-xl shadow">Total Orders: <span id="totalOrders">0</span></div>
    <div class="p-4 bg-gray-100 dark:bg-gray-800 rounded-xl shadow">Total Sales: à§³<span id="totalSales">0</span></div>
    <div class="p-4 bg-gray-100 dark:bg-gray-800 rounded-xl shadow">Customers: <span id="totalCustomers">0</span></div>
  </div>

  <div class="mb-4 flex justify-between items-center">
    <input type="text" id="searchInput" placeholder="Search by name or phone..." class="px-3 py-2 border rounded w-full md:w-1/3 text-black" onkeyup="filterOrders()">
    <button onclick="exportToExcel()" class="ml-4 px-4 py-2 bg-green-600 text-white rounded">Export to Excel</button>
  </div>

  <div id="ordersContainer" class="grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyANWkWSqHvGDlRoyD00CaJzic56fyn_qJ8",
      authDomain: "emil-fashion-ebda3.firebaseapp.com",
      projectId: "emil-fashion-ebda3",
      storageBucket: "emil-fashion-ebda3.firebasestorage.app",
      messagingSenderId: "104732916121",
      appId: "1:104732916121:web:4e50a0b3f0e80bc4c9fb08"

    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function toggleDarkMode() {
      document.documentElement.classList.toggle('dark');
    }

    function logout() {
      firebase.auth().signOut().then(() => window.location.href = 'login.html');
    }

    function exportToExcel() {
      let rows = [['Name', 'Phone', 'Product', 'Size', 'Qty', 'Delivery', 'Total']];
      orderData.forEach(order => {
        rows.push([order.name, order.phone, order.product, order.size, order.quantity, order.deliveryCharge, order.totalPrice]);
      });
      let wb = XLSX.utils.book_new();
      let ws = XLSX.utils.aoa_to_sheet(rows);
      XLSX.utils.book_append_sheet(wb, ws, "Orders");
      XLSX.writeFile(wb, "orders.xlsx");
    }

    let orderData = [];

    function loadOrders() {
      db.collection("orders").orderBy("createdAt", "desc").onSnapshot(snapshot => {
        orderData = [];
        let totalSales = 0;
        let customerSet = new Set();
        let container = document.getElementById("ordersContainer");
        container.innerHTML = '';

        snapshot.forEach(doc => {
          const data = doc.data();
          orderData.push(data);
          totalSales += data.totalPrice;
          customerSet.add(data.phone);

          const card = document.createElement('div');
          card.className = 'p-4 bg-white dark:bg-gray-800 rounded-lg shadow';
          card.innerHTML = `
            <img src="${data.image}" alt="Product" class="h-40 w-full object-cover rounded mb-2">
            <p><strong>Name:</strong> ${data.name}</p>
            <p><strong>Phone:</strong> ${data.phone}</p>
            <p><strong>Product:</strong> ${data.product}</p>
            <p><strong>Size:</strong> ${data.size} | Qty: ${data.quantity}</p>
            <p><strong>Delivery:</strong> à§³${data.deliveryCharge}</p>
            <p class="text-green-500 font-bold">Total: à§³${data.totalPrice}</p>
          `;
          container.appendChild(card);
        });

        document.getElementById("totalOrders").textContent = snapshot.size;
        document.getElementById("totalSales").textContent = totalSales;
        document.getElementById("totalCustomers").textContent = customerSet.size;
      });
    }

    function filterOrders() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const cards = document.getElementById("ordersContainer").children;
      for (let card of cards) {
        card.style.display = card.textContent.toLowerCase().includes(search) ? 'block' : 'none';
      }
    }

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        loadOrders();
      } else {
        window.location.href = 'login.html';
      }
    });
  </script>
</body>
</html>
